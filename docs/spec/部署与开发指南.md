# 金融词根翻译系统 - 部署与开发指南

## 开发环境搭建

### 前置要求

**系统要求**:
- macOS / Windows / Linux
- Go 1.23 或更高版本
- Node.js 18+ 或 Bun 1.0+

**必需工具**:
```bash
# 安装 Go
# 参考: https://golang.org/doc/install

# 安装 Bun (推荐) 或 Node.js
# Bun: https://bun.sh/
# Node.js: https://nodejs.org/

# 安装 Wails CLI
go install github.com/wailsapp/wails/v2/cmd/wails@latest
```

### 项目初始化

**克隆项目**:
```bash
git clone <repository-url>
cd rootify-wails-app
```

**安装依赖**:
```bash
# 安装 Go 依赖
wails setup

# 安装前端依赖
cd frontend
bun install  # 或 npm install / yarn install
cd ..
```

### 开发模式运行

**启动开发服务器**:
```bash
wails dev
```

**开发模式特性**:
- 热重载前端代码
- 实时编译 Go 代码
- 开发工具支持
- 自动 API 绑定生成

## 项目结构说明

### 目录结构
```
rootify-wails-app/
├── app.go                 # 后端业务逻辑
├── main.go               # 应用入口点
├── wails.json            # Wails 配置文件
├── go.mod               # Go 模块配置
├── frontend/            # 前端源码
│   ├── src/
│   │   ├── App.tsx      # 主应用组件
│   │   ├── main.tsx     # 前端入口
│   │   └── index.css    # 样式文件
│   ├── package.json     # 前端依赖
│   └── wailsjs/         # 自动生成的 API 绑定
└── build/               # 构建输出目录
```

### 配置文件详解

**wails.json** (项目配置):
```json
{
  "$schema": "https://wails.io/schemas/config.v2.json",
  "name": "rootify-wails-app",
  "outputfilename": "rootify-wails-app",
  "frontend:install": "bun install",
  "frontend:build": "bun run build",
  "frontend:dev:watcher": "bun run dev",
  "frontend:dev:serverUrl": "auto",
  "wailsjsdir": "./frontend"
}
```

**package.json** (前端配置):
- 构建工具: Vite
- 开发服务器: Vite Dev Server
- 样式框架: Tailwind CSS
- UI 组件: 原生 React + TypeScript

## 构建与打包

### 开发构建
```bash
# 生成开发版本
wails build
```

### 生产构建
```bash
# 生成生产版本（优化和压缩）
wails build -production
```

### 平台特定构建
```bash
# 仅构建 macOS 版本
wails build -platform darwin

# 仅构建 Windows 版本
wails build -platform windows

# 仅构建 Linux 版本
wails build -platform linux
```

### 构建输出
构建完成后，可执行文件位于 `build/bin/` 目录：
- macOS: `rootify-wails-app.app`
- Windows: `rootify-wails-app.exe`
- Linux: `rootify-wails-app`

## 开发工作流

### 1. 前端开发

**修改前端代码**:
- 编辑 `frontend/src/` 目录下的文件
- 开发服务器会自动热重载

**添加新的前端依赖**:
```bash
cd frontend
bun add <package-name>  # 使用 Bun
# 或
npm install <package-name>  # 使用 npm
```

**前端构建测试**:
```bash
cd frontend
bun run build  # 测试生产构建
```

### 2. 后端开发

**添加新的 Go 依赖**:
```bash
go get <package-name>
```

**修改后端 API**:
1. 在 `app.go` 中添加新的导出方法
2. 确保方法签名正确
3. 重新运行 `wails dev` 生成 TypeScript 绑定

**后端代码结构**:
```go
// 1. 方法必须导出（首字母大写）
func (a *App) NewMethod() error {
    // 实现逻辑
}

// 2. 使用适当的错误处理
func (a *App) SomeOperation() (resultType, error) {
    if err != nil {
        return nil, fmt.Errorf("操作失败: %v", err)
    }
    return result, nil
}

// 3. 并发控制
func (a *App) ThreadSafeMethod() error {
    a.mu.Lock()
    defer a.mu.Unlock()
    // 线程安全操作
}
```

### 3. API 开发流程

**添加新 API 的完整流程**:

1. **后端实现** (`app.go`):
```go
// 添加新的导出方法
func (a *App) GetStatistics() (map[string]interface{}, error) {
    a.mu.RLock()
    defer a.mu.RUnlock()

    // 实现统计逻辑
    stats := make(map[string]interface{})
    // ... 填充数据

    return stats, nil
}
```

2. **重新生成绑定**:
```bash
wails dev  # 自动生成新的 TypeScript 绑定
```

3. **前端调用** (`App.tsx`):
```typescript
import * as GoAPI from "../wailsjs/go/main/App";

// 调用新 API
const stats = await GoAPI.GetStatistics();
```

## 调试与测试

### 前端调试

**开发工具**:
- 浏览器开发者工具
- React Developer Tools
- 控制台日志

**调试技巧**:
```typescript
// 添加调试日志
console.log('当前状态:', { unifiedInput, tableData });

// 错误处理
try {
    await GoAPI.SomeMethod();
} catch (error) {
    console.error('API调用失败:', error);
}
```

### 后端调试

**日志输出**:
```go
func (a *App) SomeMethod() error {
    println("方法开始执行")  // 控制台输出

    // 业务逻辑
    if err != nil {
        println("错误:", err.Error())
        return err
    }

    return nil
}
```

**调试工具**:
- Go 的 `fmt.Println` 用于简单调试
- 使用专业的 Go 调试器（如 Delve）

### 集成测试

**手动测试流程**:
1. 启动开发服务器: `wails dev`
2. 测试各项功能:
   - 词根添加/删除
   - 批量翻译
   - 导入/导出
   - 搜索功能
3. 验证数据持久化

## 部署流程

### 1. 生产环境构建

**完整构建命令**:
```bash
# 清理旧构建
wails clean

# 生产构建
wails build -production -platform darwin -clean
```

**构建选项**:
- `-production`: 启用生产优化
- `-platform`: 指定目标平台
- `-clean`: 清理构建缓存
- `-ldflags`: 自定义链接标志

### 2. 分发准备

**macOS 应用打包**:
```bash
# 创建 DMG 安装包（需要安装 create-dmg）
create-dmg rootify-wails-app.app
```

**Windows 安装程序**:
- 使用 Inno Setup 或 NSIS 创建安装程序
- 包含必要的运行时依赖

**Linux 打包**:
- 创建 .deb 或 .rpm 包
- 或提供 AppImage 格式

### 3. 版本管理

**更新版本号**:
1. 修改 `wails.json` 中的版本信息
2. 更新前端 `package.json` 的版本号
3. 更新应用内显示的版本信息

**版本发布检查清单**:
- [ ] 所有功能测试通过
- [ ] 生产构建无错误
- [ ] 安装包创建成功
- [ ] 跨平台测试完成
- [ ] 文档更新完成

## 故障排除

### 常见问题解决

**1. 前端依赖问题**:
```bash
# 清除缓存并重新安装
cd frontend
rm -rf node_modules bun.lock
bun install
```

**2. Go 依赖问题**:
```bash
# 清理 Go 模块缓存
go clean -modcache

# 重新下载依赖
go mod tidy
go mod download
```

**3. Wails 绑定生成问题**:
```bash
# 强制重新生成绑定
wails generate

# 或重启开发服务器
wails dev
```

**4. 数据库连接问题**:
- 检查应用数据目录权限
- 确认 SQLite3 驱动正常工作
- 验证数据库文件完整性

### 性能优化建议

**前端优化**:
- 使用 React.memo 避免不必要的重渲染
- 实现虚拟滚动处理大量数据
- 优化图片和资源加载

**后端优化**:
- 数据库查询使用索引
- 合理使用缓存
- 优化并发控制策略

## 扩展开发

### 添加新功能模块

**步骤示例**:
1. 分析需求，设计数据结构和API
2. 后端实现业务逻辑
3. 前端实现用户界面
4. 集成测试
5. 文档更新

### 国际化支持

**准备多语言**:
1. 创建语言资源文件
2. 实现语言切换逻辑
3. 更新界面文本使用国际化

### 插件系统

**扩展架构**:
1. 定义插件接口
2. 实现插件加载机制
3. 提供插件开发文档

## 维护指南

### 定期维护任务

**代码质量**:
- 运行代码检查工具
- 更新依赖版本
- 重构复杂代码

**性能监控**:
- 监控内存使用
- 检查数据库性能
- 优化启动时间

### 安全更新

**依赖安全**:
- 定期检查安全漏洞
- 及时更新依赖版本
- 使用安全扫描工具

**数据安全**:
- 备份重要数据
- 验证用户输入
- 防止注入攻击

这个部署与开发指南为开发者提供了完整的项目搭建、开发、构建和部署流程，确保项目的可维护性和可扩展性。